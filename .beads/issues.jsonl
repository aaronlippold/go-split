{"id":"go-split-577","title":"Multi-language support: Ruby, Python, TypeScript, JavaScript","description":"## Vision\nExtend go-split to support splitting large files in multiple languages beyond Go.\n\n## Target Languages (by project usage)\n1. Ruby (.rb)\n2. Python (.py)\n3. TypeScript (.ts, .tsx)\n4. JavaScript (.js, .jsx)\n5. Go (.go) - already supported\n\n## Architecture Changes Required\n\n### 1. Pluggable Analyzer Interface\n```go\ntype LanguageAnalyzer interface {\n    Parse(filename string) (*FileInfo, error)\n    DetectSplitPoints() []SplitPoint\n    Language() string\n}\n```\n\n### 2. Language-Specific Implementations\n- `internal/analyzer/go/` - Current Go analyzer (move here)\n- `internal/analyzer/ruby/` - Ruby AST via parser gem or tree-sitter\n- `internal/analyzer/python/` - Python ast module or tree-sitter\n- `internal/analyzer/typescript/` - TypeScript compiler API\n- `internal/analyzer/javascript/` - Same as TS, different config\n\n### 3. Language Detection\n- File extension mapping (.rb, .py, .ts, .tsx, .js, .jsx, .go)\n- Shebang parsing for ambiguous cases\n- Optional --language flag override\n\n### 4. Considerations\n- Each language has different module/import semantics\n- Ruby: classes, modules, concerns\n- Python: classes, functions, imports\n- TS/JS: exports, classes, functions\n- The AI prompt may need language-specific context\n\n## Implementation Approach\n- AI does heavy lifting on split recommendations\n- Local analyzers provide structure info (classes, functions, imports)\n- Could use tree-sitter for unified parsing across languages\n\n## Not in Scope for v1\n- This is future work after Go support is solid\n- Focus on getting core splitting logic right first","status":"open","priority":4,"issue_type":"feature","created_at":"2025-12-28T19:42:31.285098-05:00","created_by":"alippold","updated_at":"2025-12-28T19:42:31.285098-05:00"}
{"id":"go-split-7gz","title":"Investigate TOON format for LLM efficiency","description":"TOON (Token-Oriented Object Notation) is a new format designed to reduce LLM token usage by 30-60%.\n\n## References\n- https://github.com/toon-format/toon\n- https://medium.com/data-science-in-your-pocket/toon-bye-bye-json-for-llms-91e4fe521b14\n- https://www.tensorlake.ai/blog/toon-vs-json\n\n## Status\nDeferred to v2 - format is too new (Nov 2025), only TypeScript SDK available.\n\n## When to revisit\n- Go SDK becomes available\n- Format matures with more enterprise adoption\n- Security concerns addressed","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-28T18:36:58.422805-05:00","created_by":"alippold","updated_at":"2025-12-28T18:36:58.422805-05:00","dependencies":[{"issue_id":"go-split-7gz","depends_on_id":"go-split-vwi","type":"blocks","created_at":"2025-12-28T18:37:14.512358-05:00","created_by":"daemon"}]}
{"id":"go-split-9o8","title":"Add integration tests with mocked API","description":"Add integration tests that don't require a live API:\n\n1. Create MockClient interface for API client\n2. Add testdata/ directory with golden API responses\n3. Test full flows: analyze, generate, validate, check\n4. Add -tags=integration for optional live API tests\n\n**API Capture Mode (for generating golden files):**\n- Add --capture flag or GO_SPLIT_CAPTURE=1 env var\n- When enabled, log request prompts and responses to files\n- Format: testdata/captured/\u003ctimestamp\u003e_request.txt, _response.txt\n- Makes it easy to generate new golden files from real API calls\n\nChallenges to address:\n- AI output is non-deterministic\n- Use golden files for predictable test responses\n- Mock at the HTTP level or client interface level\n\nInitial golden files from label.go already in testdata/golden/\n\nThis enables CI/CD without API costs.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T18:44:06.933907-05:00","created_by":"alippold","updated_at":"2025-12-28T18:45:53.047885-05:00"}
{"id":"go-split-am3","title":"Investigate background execution for Claude Code","description":"Check if go-split needs a --background flag for Claude Code integration.\n\nQuestions:\n- Does Claude Code's run_in_background handle this automatically?\n- Do we need progress streaming for long operations?\n- Should we support a --watch mode?\n\nMay not need anything - verify wrapper behavior first.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-28T18:37:03.70315-05:00","created_by":"alippold","updated_at":"2025-12-28T18:37:03.70315-05:00","dependencies":[{"issue_id":"go-split-am3","depends_on_id":"go-split-vwi","type":"blocks","created_at":"2025-12-28T18:37:14.682854-05:00","created_by":"daemon"}]}
{"id":"go-split-d8l","title":"Complete quality check command","description":"Finish the check command with skip flags working correctly. Add JSON output for CI integration.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T18:37:00.18315-05:00","created_by":"alippold","updated_at":"2025-12-28T20:06:18.175441-05:00","closed_at":"2025-12-28T20:06:18.175441-05:00","close_reason":"Check command complete with skip flags, JSON output, and proper UX","dependencies":[{"issue_id":"go-split-d8l","depends_on_id":"go-split-vwi","type":"blocks","created_at":"2025-12-28T18:37:14.569105-05:00","created_by":"daemon"}]}
{"id":"go-split-h4b","title":"RECOVERY: Current Session Context","description":"Context from 2025-12-28:\n\n## COMPLETED THIS SESSION:\n- ✅ go-split-d8l: Check command with skip flags and JSON output\n- ✅ go-split-qmb: JSONL output support (--jsonl flag)\n- ✅ Refactored CLI to factory pattern (NewRootCmd) for test isolation\n\n## PARTIALLY COMPLETE - NEEDS IMPROVEMENT:\n- ⚠️ go-split-n9w: Test file splitting exists BUT is flawed\n  - Current: Splits source first, then tries to split tests after\n  - NEEDED: AI should have BOTH source AND tests as context together\n\n## DECIDED v1.0 CORE FEATURES FOR TEST HANDLING:\n\n### generate command behavior:\n1. **Has tests** → AI receives BOTH source + tests in single prompt\n   - Plans splits knowing coverage relationships\n   - Outputs matched pairs (types.go + types_test.go)\n   \n2. **No tests** → AI generates test stubs for each output file\n   - Stubs compile but have t.Skip(\"TODO: implement\")\n   \n3. **After split** → Run `go test ./...` to validate\n   - Ensures split didn't break anything\n\n### generate command flags:\n- `--skip-tests` - Skip all test handling\n- `--skip-validation` - Skip running go test after split\n- `--dry-run` - Preview without writing (already exists)\n\n### analyze command (future):\n- Report test coverage gaps\n- Note which functions lack tests\n\n## GIT STATUS:\n- Branch: main\n- All changes committed and pushed\n\n## KEY FILES:\n- internal/cmd/root.go - NewRootCmd() factory\n- internal/cmd/generate.go - Test splitting logic (NEEDS REFACTOR)\n\n## NEXT SESSION PRIORITY:\n1. Refactor generate.go with v1.0 test handling\n2. Then: go-split-9o8 integration tests","status":"in_progress","priority":0,"issue_type":"task","created_at":"2025-12-28T20:18:37.250583-05:00","created_by":"alippold","updated_at":"2025-12-28T20:29:30.415328-05:00"}
{"id":"go-split-kch","title":"Generate command: report test distribution metrics","description":"Nice-to-have enhancement for generate command:\n\nAfter splitting source + tests, report:\n- How many tests were distributed to each file\n- Test count per output file\n\nExample output:\n  types.go (45 lines) → types_test.go (3 tests)\n  helpers.go (62 lines) → helpers_test.go (5 tests)\n  handlers.go (89 lines) → handlers_test.go (2 tests)\n\nLow priority - implement if v1.0 core features come together easily.","status":"open","priority":4,"issue_type":"feature","created_at":"2025-12-28T20:28:53.459879-05:00","created_by":"alippold","updated_at":"2025-12-28T20:28:53.459879-05:00"}
{"id":"go-split-kxy","title":"Add JSON output support","description":"Add --json flag for machine-readable output. Return structured JSON for analyze, generate, and check commands.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T18:36:55.175854-05:00","created_by":"alippold","updated_at":"2025-12-28T20:00:43.744336-05:00","closed_at":"2025-12-28T20:00:43.744336-05:00","close_reason":"Implemented JSON output for all commands with cobra framework","dependencies":[{"issue_id":"go-split-kxy","depends_on_id":"go-split-vwi","type":"blocks","created_at":"2025-12-28T18:37:14.401927-05:00","created_by":"daemon"}]}
{"id":"go-split-n9w","title":"Add test file awareness to generate","description":"When splitting a file, detect associated _test.go file and recommend how tests should be split to match. Show warning if tests exist but won't be split.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T18:37:01.911248-05:00","created_by":"alippold","updated_at":"2025-12-28T20:18:43.450709-05:00","closed_at":"2025-12-28T20:18:43.450709-05:00","close_reason":"Test file splitting implemented - AI now splits tests alongside source to match structure","dependencies":[{"issue_id":"go-split-n9w","depends_on_id":"go-split-vwi","type":"blocks","created_at":"2025-12-28T18:37:14.624356-05:00","created_by":"daemon"}]}
{"id":"go-split-pki","title":"RECOVERY: Current Session Context","description":"Context from 2025-12-28:\n\n## COMPLETED THIS SESSION:\n- ✅ Fixed CI failures (golangci-lint v2 + action v7)\n- ✅ Refactored CLI from hand-rolled to cobra framework\n- ✅ Added spinners (briandowns/spinner) and colored output (fatih/color)\n- ✅ Added --json flag for all commands (analyze, generate, check, validate)\n- ✅ Added --no-color flag and NO_COLOR env detection\n- ✅ Added pipe/redirect detection for non-interactive mode\n- ✅ Updated README with both API options (direct + wrapper)\n- ✅ Closed go-split-kxy (JSON output support)\n\n## KEY FILES:\n- internal/cmd/root.go - Cobra root command + global flags\n- internal/cmd/analyze.go - Analyze command\n- internal/cmd/generate.go - Generate command  \n- internal/cmd/check.go - Check command with skip flags\n- internal/cmd/validate.go - Validate command\n- internal/cmd/ui.go - UI helpers (spinners, colors)\n- internal/api/client.go - API client (wrapper + direct modes)\n\n## GIT STATUS:\n- Branch: main\n- All changes committed and pushed\n- CI should be passing\n\n## P1/P2 TASKS TO COMPLETE:\n1. go-split-d8l [P1] - Complete quality check command (may already be done, review)\n2. go-split-qmb [P2] - Add JSONL output support (--format=jsonl)\n3. go-split-n9w [P2] - Add test file awareness to generate\n4. go-split-9o8 [P2] - Integration tests with mocked API\n\n## NEXT STEPS:\n1. Run `bd show go-split-d8l` to review what's needed\n2. Check command already works - verify skip flags work correctly\n3. Add --format flag for jsonl streaming output\n4. Add test file detection in generate command\n5. Create integration tests with httptest mocked API\n\n## COMMANDS TO TEST:\n```bash\n./bin/go-split --help\n./bin/go-split check ./internal/analyzer --skip-lint\n./bin/go-split validate ./internal/cmd --json\n./bin/go-split check . --json | jq .\n```\n\n## BUILD:\n```bash\ngo build -o bin/go-split ./cmd/go-split\nmake test \u0026\u0026 make lint\n```","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-28T20:03:07.651154-05:00","created_by":"alippold","updated_at":"2025-12-28T20:06:22.474675-05:00","closed_at":"2025-12-28T20:06:22.474675-05:00","close_reason":"Context recovered successfully, resuming P2 work"}
{"id":"go-split-qmb","title":"Add JSONL output support","description":"Add --jsonl flag for newline-delimited JSON. Useful for batch operations and streaming results to pipelines.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T18:36:56.696031-05:00","created_by":"alippold","updated_at":"2025-12-28T20:14:19.380439-05:00","closed_at":"2025-12-28T20:14:19.380439-05:00","close_reason":"JSONL output support added with --jsonl flag. Refactored to factory pattern (GitHub CLI style) to fix test isolation.","dependencies":[{"issue_id":"go-split-qmb","depends_on_id":"go-split-vwi","type":"blocks","created_at":"2025-12-28T18:37:14.455298-05:00","created_by":"daemon"}]}
{"id":"go-split-s7d","title":"Add direct Anthropic API support","description":"Currently go-split only works with the claude-code-openai-wrapper which handles authentication.\n\nAdd support for direct Anthropic API usage:\n- Accept ANTHROPIC_API_KEY environment variable\n- Add --api-key flag (with warning about shell history)\n- Auto-detect: if endpoint looks like api.anthropic.com, use native Anthropic format\n- Update API client to handle both wrapper format and native Anthropic format\n\n**Reference Implementation:**\nBorrow from beads `internal/compact/haiku.go`:\n- Uses official `github.com/anthropics/anthropic-sdk-go` package\n- Implements retry with exponential backoff\n- Handles rate limiting (429) and server errors (5xx)\n- Uses `anthropic.NewClient(option.WithAPIKey(apiKey))`\n\nThis would let users run go-split without needing the wrapper running.\n\nRelated: The wrapper approach is still valuable for local dev (no key needed) and for Claude Code integration.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-28T18:43:57.464997-05:00","created_by":"alippold","updated_at":"2025-12-28T19:00:21.319216-05:00","closed_at":"2025-12-28T19:00:21.319216-05:00","close_reason":"Implemented direct Anthropic API support with SDK. Uses ANTHROPIC_API_KEY env var or --api-key flag. Includes retry with exponential backoff."}
{"id":"go-split-vwi","title":"go-split v1.0: AI-powered Go file splitter","description":"# go-split v1.0\n\nCLI tool to intelligently split large Go files into smaller, focused modules using AI analysis.\n\n## Goals\n- Analyze Go files and recommend splits\n- Generate split files with proper imports\n- Run quality checks (fmt, vet, lint, security, tests)\n- Support JSON/JSONL output for scripting\n- Detect and handle associated test files\n\n## Key Features\n- `analyze` - Show file structure and AI recommendations\n- `generate` - Create split files\n- `check` - Run quality checks\n- `validate` - Verify Go syntax\n\n## Non-Goals (v1)\n- TOON format support (too new, defer to v2)\n- Automatic test splitting (manual for now)","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-28T18:35:17.098072-05:00","created_by":"alippold","updated_at":"2025-12-28T18:35:17.098072-05:00"}
{"id":"go-split-zmv","title":"Analyze command: report test coverage gaps","description":"Enhancement for analyze command (v1.1):\n\nWhen analyzing a Go file, if a test file exists:\n- Report which functions have tests\n- Note which functions lack test coverage\n- Show coverage gaps\n\nThis fits naturally in the analyze workflow - user runs analyze first \nto understand the file, sees coverage gaps, then runs generate.\n\nPart of the broader test-aware splitting feature set.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-28T20:28:45.451628-05:00","created_by":"alippold","updated_at":"2025-12-28T20:28:45.451628-05:00"}
